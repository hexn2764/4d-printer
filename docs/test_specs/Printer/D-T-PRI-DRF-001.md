# Test Specification: D-T-PRI-DRF-001

**Test ID:** D-T-PRI-DRF-001

**Test Name:** Printer - Display Results with Formatting

**Source:** Developer

**Module:** Printer

**Category:** Display Results with Formatting

**Related Requirements:**

*   D-15
*   D-17
*   D-18
*   D-21

**Purpose:**
This test verifies that the `display_results` method of the `Printer` class, when called with `formatting=True`, correctly outputs the total duration, a formatted table of the top X entries using the `do_advanced_output` method, the total test case counts (total, parsed, and skipped), and the status counts for parsed cases.

**Preconditions:**

*   1) A `Printer` instance is created.
*   2) The `capsys` fixture is available to capture output.

**Test Data:**

*   `analysis`: A dictionary containing the total duration, a list of top X entries, test case counts, and status counts.
    ```python
    analysis = {
        "total_duration": 45.678,
        "top_x_entries": [
            (1, {"Requirement": "REQ-A", "Test Case": "TC1", "Duration": 10.0, "Status": "Passed"}),
            (2, {"Requirement": "REQ-B", "Test Case": "TC2", "Duration": 35.678, "Status": "Failed"})
        ],
        "test_case_counts": (20, 18, 2),  # 20 total, 18 parsed, 2 skipped
        "status_counts": {"Pass": 9, "Fail": 6, "Blocked": 3},
    }
    ```

**Test Steps:**

1.  Call the `display_results` method with the `analysis` data and `formatting=True`.
2.  Capture the output using `capsys.readouterr()`.

**Expected Results:**

*   1) The output should contain the total duration, formatted as "Total Duration: <value> seconds.".
*   2) The output should contain the total number of cases, parsed cases, and skipped cases, formatted as "Total Amount of Cases: <total> (<parsed> Parsed, <skipped> Skipped).".
*   3) The output should contain a "Status Counts (Parsed Cases Only):" header.
*   4) The output should contain the status counts for parsed cases (Pass, Fail, Blocked, etc.).
*   5) The output should contain a "Top X (Longest Tests):" header.
*   6) The output should contain a formatted table with a header row, a separator row, and data rows, as verified in the `test_do_advanced_output` test.

**Assertions:**

*   `assert "\nTotal Duration: 45.678 Seconds.\n" in out`: Asserts that the total duration is printed correctly.
*   `assert "Total Amount of Cases: 20 (18 Parsed, 2 Skipped)." in out`: Asserts that the total, parsed, and skipped case counts are printed correctly.
*   `assert "Status Counts (Parsed Cases Only):" in out`: Asserts that the "Status Counts" header is present.
*   `assert "Pass: 9" in out`: Asserts that the "Pass" status count is present.
*   `assert "Fail: 6" in out`: Asserts that the "Fail" status count is present.
*   `assert "Blocked: 3" in out`: Asserts that the "Blocked" status count is present.
*   `assert "Top 2 (Longest Tests):\n" in out`: Asserts that the "Top X" header is present.
*   `assert expected_header == header_line`: Asserts that the header row is present and has the correct format.
*   `assert "-"*(len(expected_header)) in out`: Asserts that the separator row is present and has the correct length.
*   `assert "-"*(len(expected_header)+1) not in out`: Asserts that the separator row does not have an extra dash
*   `match = re.search(pattern, out)` and `assert match is not None`: Asserts, using regex, that each data row is formatted according to the expected pattern.

**Postconditions:**

*   The `display_results` method has been tested with formatting enabled.
*   The output generated by `display_results` has been verified to be correctly formatted.

**Test Code:** `test_printer.py::test_display_results_with_formatting`

**Status:** Pass

**Notes:**

*   This test indirectly tests the `do_advanced_output` method by calling `display_results` with `formatting=True`.
*   The test uses `capsys` to capture the output.
*   The assertions related to the formatted table are implicitly covered by the assertions in `test_do_advanced_output`.
*   Regex is used to make the test more flexible with regards to spacing and alignment.
